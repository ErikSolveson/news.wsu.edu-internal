<?php
global $is_top_feature;
$is_top_feature = false;

get_header();
?>
<main id="wsuwp-main">
	<section class="row halves gutter top-head bottom-divider">
		<div class="column one">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 669.2 68.7">
				<title>WSU Insider Beta</title>
				<g fill="#a61d2f">
					<path d="M1.4 2.5H17l3.2 25.2c0.6 6 1.3 12.1 2 18.1h0.4c1.1-6 2.1-12.1 3.2-18.1l5.5-25.2h12.8l5.5 25.2c1.1 5.8 2.1 12 3.2 18.1H53c0.6-6.1 1.3-12.2 1.9-18.1l3.2-25.2h14.5l-9.6 57.6H43.7l-4.4-22.9c-0.9-4.4-1.6-9.2-2.1-13.5h-0.4c-0.6 4.3-1.2 9-2.1 13.5l-4.3 22.9h-19L1.4 2.5z"/>
					<path d="M71.9 53l8.7-10.5c4.1 3.3 9.2 5.6 13.5 5.6 4.6 0 6.6-1.5 6.6-4.1 0-2.7-2.9-3.6-7.8-5.6l-7.2-3c-6.2-2.5-11.6-7.7-11.6-16 0-9.8 8.9-17.9 21.4-17.9 6.6 0 13.8 2.5 19.1 7.7l-7.6 9.6c-3.9-2.7-7.3-4.2-11.5-4.2 -3.7 0-6 1.3-6 3.9 0 2.7 3.3 3.7 8.5 5.8l7 2.7c7.2 2.8 11.3 7.8 11.3 15.8 0 9.7-8.2 18.4-22.5 18.4C86.5 61.2 78.1 58.6 71.9 53z"/>
					<path d="M120.7 32.3V2.5h15.2v31.6c0 10.3 2.7 14 8.7 14 6 0 8.9-3.7 8.9-14V2.5h14.7v29.8c0 19.7-7.4 28.9-23.6 28.9C128.5 61.2 120.7 52 120.7 32.3z"/>
					<path d="M195.8 2.5H211v57.6h-15.2V2.5z"/>
					<path d="M219.4 2.5H235l12.8 25.7 5.5 12.9h0.4c-0.7-6.2-1.9-14.9-1.9-22V2.5h14.5v57.6h-15.6l-12.8-25.8 -5.5-12.9h-0.4c0.7 6.6 1.9 14.9 1.9 22v16.7h-14.5V2.5z"/>
					<path d="M270.9 53l8.7-10.5c4.1 3.3 9.2 5.6 13.5 5.6 4.6 0 6.6-1.5 6.6-4.1 0-2.7-2.9-3.6-7.8-5.6l-7.2-3c-6.2-2.5-11.6-7.7-11.6-16 0-9.8 8.9-17.9 21.4-17.9 6.6 0 13.8 2.5 19.1 7.7l-7.6 9.6c-3.9-2.7-7.3-4.2-11.5-4.2 -3.7 0-6 1.3-6 3.9 0 2.7 3.3 3.7 8.5 5.8l7 2.7c7.2 2.8 11.3 7.8 11.3 15.8 0 9.7-8.2 18.4-22.5 18.4C285.5 61.2 277.2 58.6 270.9 53z"/>
					<path d="M320.1 2.5h15.2v57.6h-15.2V2.5z"/>
					<path d="M343.6 2.5h17c17.6 0 29.6 8.2 29.6 28.5s-12.1 29.1-28.7 29.1h-17.9V2.5zM359.8 47.9c8.3 0 14.9-3.4 14.9-16.8 0-13.5-6.6-16.3-14.9-16.3h-0.9v33.2H359.8z"/>
					<path d="M395 2.5h37.2v12.8h-22v9H429v12.8h-18.8v10.3h22.9v12.8H395V2.5z"/>
					<path d="M439.8 2.5h21.8c12.4 0 23 4.3 23 18.6 0 8.2-3.7 13.7-9.3 16.7l12.5 22.3h-17l-9.9-19.3h-5.9v19.3h-15.2V2.5zM460.6 28.8c6 0 9.2-2.7 9.2-7.6s-3.2-6.6-9.2-6.6h-5.5v14.2H460.6z"/>
				</g>
				<g fill="#333334">
					<path d="M519.8 55.9h-0.3l-1.1 4.4h-10.8V4.2h13.9v13.1l-0.3 5.8c2.8-2.6 6.4-4 9.9-4 9.5 0 15.7 8.1 15.7 20.4 0 13.9-8.2 21.8-16.8 21.8C526.4 61.2 522.9 59.4 519.8 55.9zM532.5 39.6c0-6.6-1.9-9.3-5.6-9.3 -2.1 0-3.7 0.8-5.5 2.9V48c1.6 1.5 3.4 1.9 5.2 1.9C529.8 49.9 532.5 47.4 532.5 39.6z"/>
					<path d="M550.2 40.1c0-13.1 9.5-21.1 19.3-21.1 11.9 0 17.6 8.7 17.6 19.5 0 2.4-0.3 4.8-0.6 5.8h-23c1.3 4.8 4.8 6.4 9.3 6.4 2.7 0 5.3-0.8 8.2-2.4l4.5 8.2c-4.4 3.1-10.2 4.7-14.7 4.7C559.2 61.2 550.2 53.5 550.2 40.1zM575.4 35.3c0-3.1-1.3-5.8-5.5-5.8 -3.1 0-5.6 1.8-6.4 5.8H575.4z"/>
					<path d="M595.7 44.8v-14h-5.3V20.4l6.1-0.5 1.6-10.5h11.4V20h9.2v10.8h-9.2v13.8c0 4.4 2.3 5.9 4.8 5.9 1.3 0 2.6-0.3 3.5-0.6l2.1 10c-2.1 0.6-5.1 1.5-9.5 1.5C600 61.2 595.7 54.6 595.7 44.8z"/>
					<path d="M624.9 48.8c0-8.4 6.4-13.1 21.9-14.7 -0.3-2.9-2.1-4.2-5.6-4.2 -2.9 0-6 1.1-10.2 3.4l-4.8-9c5.6-3.4 11.4-5.3 17.7-5.3 10.5 0 16.8 5.6 16.8 18.9v22.4h-11.3l-1-3.9h-0.3c-3.2 2.9-6.8 4.8-11.1 4.8C629.4 61.2 624.9 55.4 624.9 48.8zM646.8 47.8v-5.5c-6.6 1-8.7 3.1-8.7 5.3 0 1.9 1.3 2.9 3.7 2.9C644 50.6 645.3 49.4 646.8 47.8z"/>
				</g>
			</svg>
		</div>
		<div class="column two">
			<div id="mc_embed_signup">
				<form action="https://wsu.us3.list-manage.com/subscribe/post?u=02b3cd67989caec2eec47f036&amp;id=21d653f16c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					<div id="mc_embed_signup_scroll">
						<label for="mce-EMAIL">Sign up for the WSU Insider daily email newsletter</label>
						<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
						<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
						<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_02b3cd67989caec2eec47f036_21d653f16c" tabindex="-1" value=""></div>
						<input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
					</div>
				</form>
			</div>
		</div>
	</section>
	<?php do_action( 'homepage' ); ?>
	<?php
	$exclude_post_ids = array();
	$featured_query = new WP_Query( array(
		'post_type' => 'post',
		'posts_per_page' => 5,
		'post_status' => 'publish',
		'meta_query' => array(
			array(
				'key' => '_news_internal_featured',
				'value' => 'yes',
			),
		),
	) );

	if ( $featured_query->have_posts() ) {
		?>
		<section class="row single gutter pad-top bottom-divider">
			<div class="column one ">
				<div class="deck deck--featured">
				<?php

				$featured_count = 0;
				while( $featured_query->have_posts() ) {
					$featured_query->the_post();
					$exclude_post_ids[] = get_the_ID();

					if ( 0 === $featured_count ) {
						$is_top_feature = true;
					} else {
						$is_top_feature = false;
					}

					get_template_part( 'parts/card-content' );

					$featured_count++;
				}
				wp_reset_postdata();
				$is_top_feature = false;
				?>
				</div>
			</div>
		</section>
		<?php
	}

	$query_cats = array(
		'news-updates' => array(
			'count' => 8,
			'background' => 1,
			'classes' => array(),
		),
		'events' => array(
			'count' => 8,
			'background' => 0,
			'classes' => array(
				'bg-none',
			),
		),
		'benefits' => array(
			'count' => 8,
			'background' => 1,
			'classes' => array(
				'bottom-divider',
			),
		),
		'wellness' => array(
			'count' => 8,
			'background' => 1,
			'classes' => array(
				'bottom-divider',
			),
		),
		'training' => array(
			'count' => 8,
			'background' => 1,
			'classes' => array(
				'bottom-divider',
			),
		),
		'coug-life' => array(
			'count' => 8,
			'background' => 1,
			'classes' => array(
				'bottom-divider',
			),
		),
		'cheers' => array(
			'count' => 8,
			'background' => 1,
			'classes' => array(),
		),
	);


	foreach ( $query_cats as $category_slug => $category_options ) {
		$category_query_args = array(
			'post_type' => 'post',
			'posts_per_page' => (int) $category_options['count'],
			'post_status' => 'publish',
			'post__not_in' => $exclude_post_ids,
			'category_name' => $category_slug,
		);
		$category_query = new WP_Query( $category_query_args );

		if ( $category_query->have_posts() ) {
			$category_data = get_term_by( 'slug', $category_slug, 'category' );

			$section_classes = array(
				'row',
				'single',
				'gutter',
				'pad-top',
				'cat-sec',
			);
			$section_classes = array_merge( $section_classes, $category_options['classes'] );
			?>
			<section class="<?php echo esc_attr( implode( ' ', $section_classes ) ); ?>">
				<div class="column one ">

					<header>
						<h2><?php echo esc_html( $category_data->name ); ?></h2>
					</header>
					<div class="deck">
					<?php
					while( $category_query->have_posts() ) {
						$category_query->the_post();
						get_template_part( 'parts/card-content' );
					}
					wp_reset_postdata();
					?>
					</div>
					<p><a class="button" href="<?php echo esc_url( get_term_link( $category_data->term_id ) ); ?>">View all <?php echo esc_html( $category_data->name ); ?></a></p>
				</div>
			</section>
			<?php
		}
		wp_reset_postdata();
	}
	?>
</main>
<?php

get_footer();
